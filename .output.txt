?       blocowallet/cmd/blocowallet     [no test files]
?       blocowallet/internal/blockchain [no test files]
?       blocowallet/internal/constants  [no test files]
ok      blocowallet/internal/storage    0.754s
ok      blocowallet/internal/ui 1.301s
=== Config Initialization Test ===
âœ… Home directory: /Users/italo
âœ… App directory created: /Users/italo/.wallets-config-test
âœ… Configuration loaded successfully
   AppDir: /Users/italo/.wallets
   WalletsDir: /Users/italo/.wallets/keystore
   DatabasePath: /Users/italo/.wallets/wallets.db
âœ… Localization initialized successfully
   Label 'error_crypto_service_not_initialized': 'Crypto service not initialized'
   Label 'error_empty_password': 'Password cannot be empty'
   Label 'version': '0.2.0'
   Label 'welcome_message': 'Welcome to the BLOCO Wallet!
Select an option from the menu.'
âœ… CryptoService initialized successfully
âœ… Mnemonic encryption successful
âœ… Mnemonic decryption successful
âœ… All initialization steps completed successfully!
=== Config with Real Paths Test ===
Real app directory: /Users/italo/.wallets
âœ… Real app directory exists
âœ… Real configuration loaded
âœ… Real localization initialized
âœ… Real CryptoService initialized
âœ… Real mnemonic encryption works
âœ… Real application setup works correctly!
=== Error Messages Test ===
--- Without CryptoService ---
--- FAIL: TestErrorMessages (0.05s)
    config_debug_test.go:141:
                Error Trace:    /Users/italo/Projects/lab/wallet/bloco-wallet-manager/internal/wallet/config_debug_test.go:141
                Error:          An error is expected but got nil.
                Test:           TestErrorMessages
--- FAIL: TestFinalIntegrationComplexPassword (4.20s)
    final_integration_test.go:47: ğŸ§ª Testing final integration with complex password keystore
    final_integration_test.go:48:    File: testdata/keystores/real_keystore_v3_complex_password.json
    final_integration_test.go:49:    Password: P@$$w0rd!123#ComplexPassword
    final_integration_test.go:50:    Expected Address: 0xF32f7C95CD7f616674Cb06d5E253CAC345E2722B
    --- FAIL: TestFinalIntegrationComplexPassword/Direct_ImportWalletFromKeystoreV3 (1.19s)
        final_integration_test.go:56:
                Error Trace:    /Users/italo/Projects/lab/wallet/bloco-wallet-manager/internal/wallet/final_integration_test.go:56
                Error:          Received unexpected error:
                                Incorrect password or corrupted keystore file: MAC invÃ¡lido - senha incorreta ou arquivo corrompido
                Test:           TestFinalIntegrationComplexPassword/Direct_ImportWalletFromKeystoreV3
                Messages:       Direct import should succeed
    --- FAIL: TestFinalIntegrationComplexPassword/TUI_ImportWalletFromKeystore (1.16s)
        final_integration_test.go:75:
                Error Trace:    /Users/italo/Projects/lab/wallet/bloco-wallet-manager/internal/wallet/final_integration_test.go:75
                Error:          Received unexpected error:
                                Incorrect password or corrupted keystore file: MAC invÃ¡lido - senha incorreta ou arquivo corrompido
                Test:           TestFinalIntegrationComplexPassword/TUI_ImportWalletFromKeystore
                Messages:       TUI import should succeed
    --- FAIL: TestFinalIntegrationComplexPassword/Method_Consistency (0.99s)
        final_integration_test.go:93:
                Error Trace:    /Users/italo/Projects/lab/wallet/bloco-wallet-manager/internal/wallet/final_integration_test.go:93
                Error:          Received unexpected error:
                                Incorrect password or corrupted keystore file: MAC invÃ¡lido - senha incorreta ou arquivo corrompido
                Test:           TestFinalIntegrationComplexPassword/Method_Consistency
    final_integration_test.go:128: FAIL:        AddWallet(mock.anythingOfTypeArgument)
                        at: [/Users/italo/Projects/lab/wallet/bloco-wallet-manager/internal/wallet/final_integration_test.go:28]
    final_integration_test.go:128: FAIL: 1 out of 2 expectation(s) were met.
                The code you are testing needs to make 1 more call(s).
                at: [/Users/italo/Projects/lab/wallet/bloco-wallet-manager/internal/wallet/final_integration_test.go:128]
    final_integration_test.go:130: ğŸ‰ Final integration test completed successfully!
    final_integration_test.go:131:    âœ… Direct method works
    final_integration_test.go:132:    âœ… TUI method works
    final_integration_test.go:133:    âœ… Both methods are consistent
    final_integration_test.go:134:    âœ… Error handling works correctly
    final_integration_test.go:135:    âœ… Universal KDF integration is complete
=== Keystore Password Debug ===
File: testdata/keystores/real_keystore_v3_complex_password.json
Size: 491 bytes
KDF Parameters:
  Salt: 53bb6abbe51fcda2c95a4f096d9fcc7e933fbdc62cfbde3a1de4327e658a88a6
  N: 262144
  R: 8
  P: 1
  DKLen: 32
Expected MAC: 9f8750c656d0a9278d4b2d902293ff1d4ad9bb508c1e86a9dd775727b6579531
--- Testing password 1: 'ComplexPassword123!@#' ---
âœ… SUCCESS with standard keystore decryption!
   Address: 0x12fabDE135359Fa5a442cb01b48F254D6c62e995
Generated new keystore:
Address: 0xcb3d531Acf7916EE52c42fF3404C1da9CE55201B
Path: /var/folders/zj/8_s3qxw5369gk9wqysltf9_40000gn/T/TestGenerateNewKeystoreForTesting2447387527/001/UTC--2025-08-15T03-01-05.022458000Z--cb3d531acf7916ee52c42ff3404c1da9ce55201b
Keystore content:
{"address":"cb3d531acf7916ee52c42ff3404c1da9ce55201b","crypto":{"cipher":"aes-128-ctr","ciphertext":"65467e60b4054107ec05315b7cb1eb181ed64d2400e2d38de8288048b0084da0","cipherparams":{"iv":"d44bee27a9edd2f035999fad19d3f181"},"kdf":"scrypt","kdfparams":{"dklen":32,"n":262144,"p":1,"r":8,"salt":"71171c21349636e5d8b7635ed73e47992d3f58a841336bb8805ac0243622374d"},"mac":"f48faf0cb75429bc56c97df4ed16a158a1b119a6dda1b370fe2bfc176008de8d"},"id":"f1edfc29-8c52-451b-9f76-a5eecf25e895","version":3}
âœ… Successfully decrypted with password: ComplexPassword123!@#
Address matches: true
--- FAIL: TestImportWalletFromKeystoreV3WithUniversalKDF (1.79s)
    --- FAIL: TestImportWalletFromKeystoreV3WithUniversalKDF/Complex_Password_KeyStore (0.76s)
        keystore_universal_kdf_test.go:90:
                Error Trace:    /Users/italo/Projects/lab/wallet/bloco-wallet-manager/internal/wallet/keystore_universal_kdf_test.go:90
                Error:          Received unexpected error:
                                Incorrect password or corrupted keystore file: MAC invÃ¡lido - senha incorreta ou arquivo corrompido
                Test:           TestImportWalletFromKeystoreV3WithUniversalKDF/Complex_Password_KeyStore
=== Simple Keystore Import Debug ===
File: testdata/keystores/real_keystore_v3_complex_password.json
Password: ComplexPassword123!@#
âœ… Direct keystore decryption successful
   Address: 0x12fabDE135359Fa5a442cb01b48F254D6c62e995
   Private Key Length: 32 bytes
   Private Key (hex): a07e79e422a8e09c57a2b9cb9027e6f31d08a1cd05b929309eb1c4b3510bff02
=== Testing Universal KDF Step by Step ===
âœ… Compatibility check passed
âœ… Keystore validation passed
âœ… Key derivation successful
   Derived Key Length: 32 bytes
   Derived Key (hex): b179cc88916b48ac773a3fec410a43c36175392e482a17e11af20d094ccb4957
âœ… MAC verification passed
âœ… Private key decryption successful
   Decrypted Key Length: 32 bytes
   Decrypted Key (hex): a07e79e422a8e09c57a2b9cb9027e6f31d08a1cd05b929309eb1c4b3510bff02
âœ… ECDSA conversion successful
=== Comparison ===
Direct decryption key:    a07e79e422a8e09c57a2b9cb9027e6f31d08a1cd05b929309eb1c4b3510bff02
Universal KDF key:        a07e79e422a8e09c57a2b9cb9027e6f31d08a1cd05b929309eb1c4b3510bff02
Keys match: true
Direct address:    0x12fabDE135359Fa5a442cb01b48F254D6c62e995
Universal address: 0x12fabDE135359Fa5a442cb01b48F254D6c62e995
Addresses match: true
âœ… All tests passed!
=== TUI Condition Debug ===
Estado da TUI simulado:
  mnemonic: 'testdata/keystores/real_keystore_v3_complex_password.json'
  privateKeyInput.Value(): ''
  currentView: 'ImportWalletPasswordView'
Testando condiÃ§Ãµes:
  CondiÃ§Ã£o 1 (private key): false
    currentView == 'ImportWalletPasswordView': true
    len(privateKeyInput.Value()) > 0: false (len=0)
  CondiÃ§Ã£o 2 (keystore): true
    mnemonic != '': true
    currentView == 'ImportWalletPasswordView': true
  CondiÃ§Ã£o 3 (mnemonic - else): false
Resultado:
  âœ… Chamaria ImportWalletFromKeystore() - CORRETO!
=== TUI Condition with Real Constants ===
PossÃ­vel problema: privateKeyInput pode estar sendo reutilizado
  1. initImportKeystore() usa privateKeyInput para o caminho
  2. updateImportKeystore() armazena caminho em mnemonic
  3. Mas privateKeyInput pode ainda conter o caminho?
Se privateKeyInput contÃ©m o caminho:
  privateKeyInput.Value(): 'testdata/keystores/real_keystore_v3_complex_password.json'
  len(privateKeyInput.Value()) > 0: true
  CondiÃ§Ã£o 1 (private key): true
  âŒ Chamaria ImportWalletFromPrivateKey() com o CAMINHO do arquivo!
      Isso causaria 'invalid private key format' porque:
      - Tentaria usar o caminho como chave privada
      - Verificaria se len(privateKeyHex) != 64
      - Caminho tem 57 caracteres, nÃ£o 64
      - Retornaria 'invalid private key format'
=== TUI Debug with Detailed Logging ===
âœ… CryptoService initialized
--- Testing Complex Password ---
File: testdata/keystores/real_keystore_v3_complex_password.json
Password: ComplexPassword123!@#
âœ… File read: 491 bytes
âœ… Direct keystore decryption successful: 0x12fabDE135359Fa5a442cb01b48F254D6c62e995
âœ… ImportWalletFromKeystore successful!
   Address: 0x12fabDE135359Fa5a442cb01b48F254D6c62e995
   Path: /Users/italo/.wallets/keystore/0x12fabDE135359Fa5a442cb01b48F254D6c62e995.json
--- Testing Simple Password ---
File: testdata/keystores/real_keystore_v3_simple_password.json
Password: password123
âŒ File not found, skipping
=== Debug Specific Error Scenarios ===
--- Test 1: Without CryptoService ---
âŒ Unexpected success without CryptoService
--- Test 2: With CryptoService ---
âœ… CryptoService initialized
âœ… Success with CryptoService
=== TUI Exact Simulation Test ===
âœ… CryptoService initialized
âœ… KeyStore created at: /var/folders/zj/8_s3qxw5369gk9wqysltf9_40000gn/T/TestTUIExactSimulation1832221192/001/keystore
âœ… WalletService created
âœ… File exists: testdata/keystores/real_keystore_v3_complex_password.json
âœ… File size OK: 491 bytes
âœ… Keystore path stored in mnemonic field: testdata/keystores/real_keystore_v3_complex_password.json
âœ… Password trimmed: 'ComplexPassword123!@#'
âœ… Password validation passed
âœ… Using keystore import method
   Name: Imported Keystore Wallet
   Keystore Path: testdata/keystores/real_keystore_v3_complex_password.json
âœ… ImportWalletFromKeystore successful!
   Wallet Address: 0x12fabDE135359Fa5a442cb01b48F254D6c62e995
   Keystore Path: /Users/italo/.wallets/keystore/0x12fabDE135359Fa5a442cb01b48F254D6c62e995.json
   Import Method: keystore
   Has Mnemonic: true
   KDF Type: scrypt
   KDF Security Level: Medium
âœ… TUI Exact Simulation completed successfully!
=== TUI Real Application Test ===
âœ… Using real application directories:
   App Dir: /Users/italo/.wallets
   Keystore Dir: /Users/italo/.wallets/keystore
âœ… CryptoService initialized with real config
âœ… Real application test successful!
   Wallet Address: 0x12fabDE135359Fa5a442cb01b48F254D6c62e995
   Keystore Path: /Users/italo/.wallets/keystore/0x12fabDE135359Fa5a442cb01b48F254D6c62e995.json
=== TUI Flow Debug Test ===
Keystore Path: testdata/keystores/real_keystore_v3_complex_password.json
Password: ComplexPassword123!@#
Name: Test Keystore Import
âœ… File exists
âœ… File size: 491 bytes
âœ… File read successfully, 491 bytes
âœ… JSON parsing successful
âœ… Crypto section found
âœ… KDF type: scrypt
=== Calling ImportWalletFromKeystore ===
âœ… ImportWalletFromKeystore successful
   Wallet Address: 0x12fabDE135359Fa5a442cb01b48F254D6c62e995
   Keystore Path: /Users/italo/.wallets/keystore/0x12fabDE135359Fa5a442cb01b48F254D6c62e995.json
âœ… Test completed successfully
=== Testing Complex Password Keystore ===
âœ… Complex Password Keystore import successful
=== Testing Simple Password Keystore ===
Password validation error: Password must have at least 8 characters
Password validation error: Password must have at least 8 characters
--- FAIL: TestTUIPasswordValidation (0.00s)
    --- FAIL: TestTUIPasswordValidation/Password_password123 (0.00s)
        tui_flow_debug_test.go:215:
                Error Trace:    /Users/italo/Projects/lab/wallet/bloco-wallet-manager/internal/wallet/tui_flow_debug_test.go:215
                Error:          Should be true
                Test:           TestTUIPasswordValidation/Password_password123
                Messages:       Password should be valid: password123
ğŸ”§ UNIVERSAL KDF COMPATIBILITY DEMONSTRATION
============================================================
1. ğŸ§ª Testing: Geth Standard (Ethereum Geth)
--------------------------------------------------
âœ… Compatible: true
ğŸ”‘ KDF: scrypt â†’ scrypt
ğŸ›¡ï¸  Security: Medium
ğŸ¯ Key Features:
   â€¢ Standard JSON float64 parameters
   â€¢ Lowercase parameter names
   â€¢ Standard scrypt configuration
âš ï¸ Analysis:
   â€¢ ParÃ¢metros validados com sucesso
ğŸ’¡ Security Recommendations:
   â€¢ SeguranÃ§a adequada para uso geral
   â€¢ âš ï¸ Usando parÃ¢metros padrÃ£o - considere personalizaÃ§Ã£o para aplicaÃ§Ãµes de alto valor
2. ğŸ§ª Testing: MetaMask Variant (MetaMask Browser Extension)
--------------------------------------------------
âœ… Compatible: true
ğŸ”‘ KDF: Scrypt â†’ scrypt
ğŸ›¡ï¸  Security: Medium
ğŸ¯ Key Features:
   â€¢ Case variation in KDF name (Scrypt vs scrypt)
   â€¢ Mixed parameter types (string, int, float)
   â€¢ CamelCase parameter names (dkLen, Salt)
âš ï¸ Analysis:
   â€¢ ParÃ¢metros validados com sucesso
ğŸ’¡ Security Recommendations:
   â€¢ SeguranÃ§a adequada para uso geral
   â€¢ âš ï¸ Usando parÃ¢metros padrÃ£o - considere personalizaÃ§Ã£o para aplicaÃ§Ãµes de alto valor
3. ğŸ§ª Testing: Trust Wallet Mobile (Trust Wallet Mobile App)
--------------------------------------------------
âœ… Compatible: true
ğŸ”‘ KDF: SCRYPT â†’ scrypt
ğŸ›¡ï¸  Security: Medium
ğŸ¯ Key Features:
   â€¢ Uppercase KDF name (SCRYPT)
   â€¢ Alternative parameter names (cost, blocksize, parallel)
   â€¢ Different security level (lower N parameter)
âš ï¸ Analysis:
   â€¢ ParÃ¢metros validados com sucesso
ğŸ’¡ Security Recommendations:
   â€¢ SeguranÃ§a adequada para uso geral
   â€¢ âš ï¸ Usando parÃ¢metros padrÃ£o - considere personalizaÃ§Ã£o para aplicaÃ§Ãµes de alto valor
4. ğŸ§ª Testing: PBKDF2 Ledger (Ledger Hardware Wallet)
--------------------------------------------------
âœ… Compatible: true
ğŸ”‘ KDF: pbkdf2 â†’ pbkdf2
ğŸ›¡ï¸  Security: Medium
ğŸ¯ Key Features:
   â€¢ Different KDF algorithm (PBKDF2 vs Scrypt)
   â€¢ Different parameter set (c, prf vs n, r, p)
   â€¢ SHA-256 hash function specification
âš ï¸ Analysis:
   â€¢ ParÃ¢metros validados com sucesso
ğŸ’¡ Security Recommendations:
   â€¢ PBKDF2 menos resistente que scrypt contra ataques GPU
============================================================
ğŸ¯ UNIVERSAL KDF ACHIEVEMENTS:
âœ… Supports multiple KDF algorithms (scrypt, pbkdf2, variations)
âœ… Handles different JSON data types (int, float64, string, json.Number)
âœ… Recognizes parameter name variations (case-insensitive, alternatives)
âœ… Provides automatic security analysis and recommendations
âœ… Maintains compatibility with 95%+ of KeyStore V3 files
âœ… Extensible architecture for future KDF algorithms
ğŸ“Š COMPATIBILITY COMPARISON:
Aspect               | Before          | After
-------------------------------------------------------
KeyStore Support     | ~60%            | ~95%
JSON Types           | float64 only    | All types
Parameter Names      | Fixed           | Flexible
KDF Algorithms       | 2 variants      | 6+ variants
Security Analysis    | None            | Automatic
Error Handling       | Generic         | Specific
ğŸ”„ PARAMETER CONVERSION DEMONSTRATION
=============================================
ğŸ“‹ Standard Geth (float64)
   JSON unmarshaling typically produces float64
   Input: map[dklen:32 n:262144 p:1 r:8]
   Extracted: n=262144, r=8, p=1, dklen=32
   âœ… Successfully converted all parameters
ğŸ“‹ Mixed Types
   Real-world keystores often have mixed types
   Input: map[dklen:32 n:262144 p:1 r:8]
   Extracted: n=262144, r=8, p=1, dklen=32
   âœ… Successfully converted all parameters
ğŸ“‹ Alternative Names
   Different wallet providers use different naming
   Input: map[N:262144 P:1 R:8 dkLen:32]
   Extracted: n=262144, r=8, p=1, dklen=32
   âœ… Successfully converted all parameters
FAIL
FAIL    blocowallet/internal/wallet     51.795s
?       blocowallet/pkg/config  [no test files]
--- FAIL: TestGetKeystoreErrorMessage (0.00s)
    --- FAIL: TestGetKeystoreErrorMessage/Unknown_error_key (0.00s)
        keystore_messages_test.go:72: GetKeystoreErrorMessage("unknown_error") = "Error desconocido", want "unknown_error"
FAIL
FAIL    blocowallet/pkg/localization    2.247s
?       blocowallet/pkg/logger  [no test files]
FAIL
